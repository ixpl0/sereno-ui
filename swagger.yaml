basePath: /api/v1
schemes:
  - http
definitions:
  server.ResponseError:
    properties:
      error:
        type: string
      request_id:
        example: 00112233-4455-6677-8899-aabbccddeeff
        type: string
    type: object
  tenant.RequestID:
    properties:
      id:
        example: 00112233-4455-6677-8899-aabbccddeeff
        type: string
    required:
    - id
    type: object
  tenant.RequestIDRole:
    properties:
      id:
        example: 00112233-4455-6677-8899-aabbccddeeff
        type: string
      role:
        enum:
        - admin
        - member
        example: admin
        type: string
    required:
    - id
    - role
    type: object
  tenant.RequestName:
    properties:
      name:
        example: Name of this subject
        maxLength: 64
        minLength: 1
        type: string
    required:
    - name
    type: object
  tenant.ResponseMember:
    properties:
      id:
        example: 00112233-4455-6677-8899-aabbccddeeff
        type: string
      name:
        example: Ivan Ivanov
        type: string
      role:
        example: admin
        type: string
      since:
        example: 1766412596
        type: integer
    type: object
  tenant.ResponseMembersList:
    properties:
      members:
        items:
          $ref: '#/definitions/tenant.ResponseMember'
        type: array
    type: object
  tenant.ResponseSingleMember:
    properties:
      member:
        $ref: '#/definitions/tenant.ResponseMember'
    type: object
  tenant.ResponseSingleTenant:
    properties:
      tenant:
        $ref: '#/definitions/tenant.ResponseTenant'
    type: object
  tenant.ResponseTenant:
    properties:
      id:
        example: 00112233-4455-6677-8899-aabbccddeeff
        type: string
      name:
        example: My first tenant
        type: string
      role:
        example: admin
        type: string
      since:
        example: 1766412596
        type: integer
    type: object
  tenant.ResponseTenantsList:
    properties:
      tenants:
        items:
          $ref: '#/definitions/tenant.ResponseTenant'
        type: array
    type: object
  user.RequestCode:
    properties:
      code:
        example: "12345678"
        type: string
    required:
    - code
    type: object
  user.RequestContact:
    properties:
      kind:
        enum:
        - email
        - telegram
        example: email
        type: string
      value:
        example: admin@example.com
        type: string
    required:
    - kind
    - value
    type: object
  user.RequestEmail:
    properties:
      email:
        example: user@example.com
        type: string
    required:
    - email
    type: object
  user.RequestEmailCode:
    properties:
      code:
        example: "12345678"
        type: string
      email:
        example: user@example.com
        type: string
    required:
    - code
    - email
    type: object
  user.RequestParameter:
    properties:
      kind:
        enum:
        - first_name
        - last_name
        - timezone
        example: first_name
        type: string
      value:
        example: Ivan
        type: string
    required:
    - kind
    - value
    type: object
  user.ResponseAccessJWT:
    properties:
      token:
        example: eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVCJ9.eyJ0...ZiJ9.MFrP...ddBw
        type: string
      type:
        example: bearer
        type: string
    type: object
  user.ResponseContact:
    properties:
      id:
        example: 00112233-4455-6677-8899-aabbccddeeff
        type: string
      kind:
        example: email
        type: string
      value:
        example: user@example.com
        type: string
      verified:
        example: true
        type: boolean
    type: object
  user.ResponseContactsList:
    properties:
      contacts:
        items:
          $ref: '#/definitions/user.ResponseContact'
        type: array
    type: object
  user.ResponseSession:
    properties:
      current:
        example: true
        type: boolean
      device:
        example: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0
        type: string
      id:
        example: 00112233-4455-6677-8899-aabbccddeeff
        type: string
      since:
        example: 1766412596
        type: integer
    type: object
  user.ResponseSessions:
    properties:
      sessions:
        items:
          $ref: '#/definitions/user.ResponseSession'
        type: array
    type: object
  user.ResponseSingleContact:
    properties:
      contact:
        $ref: '#/definitions/user.ResponseContact'
    type: object
  user.ResponseUser:
    properties:
      first_name:
        example: Ivan
        type: string
      id:
        example: 00112233-4455-6677-8899-aabbccddeeff
        type: string
      last_name:
        example: Ivanov
        type: string
      timezone:
        example: Europe/Moscow
        type: string
    type: object
host: localhost:8080
info:
  contact: {}
  description: Duty компонент Sereno Systems
  title: Sereno Duty REST API
paths:
  /auth/login/{provider}:
    get:
      description: Вход через поддерживаемых OAuth провайдеров
      parameters:
      - description: 'OAuth provider: yandex, vk, keycloak'
        in: path
        name: provider
        required: true
        type: string
      responses: {}
      summary: (NotImplemented) Вход через OAuth
      tags:
      - auth
  /auth/login/{provider}/callback:
    get:
      description: Обработка OAuth Callback от провайдера
      parameters:
      - description: 'OAuth provider: yandex, vk, keycloak'
        in: path
        name: provider
        required: true
        type: string
      responses: {}
      summary: (NotImplemented) OAuth сallback
      tags:
      - auth
  /auth/login/email:
    post:
      consumes:
      - application/json
      description: Проверяет Email и одноразовый код, создает/обновляет сессию и отдает
        новые AccessJWT + RefreshJWT
      parameters:
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/user.RequestEmailCode'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          headers:
            Set-Cookie:
              description: jwt_refresh=...; Path=/api/v1/auth/refresh; Max-Age=864000;
                Secure; HttpOnly
              type: string
          schema:
            $ref: '#/definitions/user.ResponseAccessJWT'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      summary: Вход по Email
      tags:
      - auth
  /auth/login/email/code:
    post:
      consumes:
      - application/json
      description: Формируется и отправляется на электронную почту одноразовый код
        аутентификации по Email
      parameters:
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/user.RequestEmail'
      produces:
      - application/json
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      summary: Запрос кода на Email
      tags:
      - auth
  /auth/logout:
    post:
      consumes:
      - application/json
      description: Удаляет сессию из репозитория и Cookie
      responses:
        "204":
          description: No Content
          headers:
            Set-Cookie:
              description: jwt_refresh=empty; Path=/api/v1/auth/refresh; Max-Age=-1;
                Secure; HttpOnly
              type: string
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Выход
      tags:
      - auth
  /auth/refresh:
    post:
      description: Валидирует RefreshJWT, обновляет существующую сессию и отдает новый
        AccessJWT
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/user.ResponseAccessJWT'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - RefreshJWT: []
      summary: Новый AccessJWT
      tags:
      - auth
  /tenants:
    get:
      description: Возвращает список тенантов текущего пользователя с указанием прав
        доступа
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/tenant.ResponseTenantsList'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Список тенантов пользователя
      tags:
      - tenants
  /tenants/{id}/members:
    get:
      description: Возвращает пользователей Tenant по его ID
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/tenant.ResponseMembersList'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Список пользователей тенанта
      tags:
      - tenant/members
  /tenants/{id}/members/delete:
    post:
      consumes:
      - application/json
      description: Удаляет пользователь из Tenant по его ID
      parameters:
      - description: Tenant ID
        in: path
        name: id
        required: true
        type: string
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/tenant.RequestID'
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Удаление пользователя из тенанта
      tags:
      - tenant/members
  /tenants/{id}/members/update:
    post:
      consumes:
      - application/json
      description: Добавляет / изменяет права пользователя в Tenant по его ID
      parameters:
      - description: Tenant ID
        in: path
        name: id
        required: true
        type: string
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/tenant.RequestIDRole'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/tenant.ResponseSingleMember'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Управление пользователями в тенанте
      tags:
      - tenant/members
  /tenants/{id}/tokens:
    get:
      description: Возвращает список статичных токенов для Tenant по его ID используемые
        сервисами алертинга и мониторинга
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Список статичных токенов
      tags:
      - tenant/tokens
  /tenants/{id}/tokens/create:
    post:
      consumes:
      - application/json
      description: Создает статичный токен, используемый сервисами алертинга и мониторинга
      parameters:
      - description: Tenant ID
        in: path
        name: id
        required: true
        type: string
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/tenant.RequestName'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Создание статичного токена
      tags:
      - tenant/tokens
  /tenants/{id}/tokens/delete:
    post:
      description: Удаляет интеграционный токен по его ID
      parameters:
      - description: Tenant ID
        in: path
        name: id
        required: true
        type: string
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/tenant.RequestID'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Удаление интеграционного токена
      tags:
      - tenant/tokens
  /tenants/{id}/update:
    post:
      consumes:
      - application/json
      description: 'Изменяет Tenant: название, ...'
      parameters:
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/tenant.RequestName'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/tenant.ResponseSingleTenant'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Изменение тенант
      tags:
      - tenants
  /tenants/create:
    post:
      consumes:
      - application/json
      description: Создает новый Tenant с указанным названием
      parameters:
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/tenant.RequestName'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/tenant.ResponseSingleTenant'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Создание тенант
      tags:
      - tenants
  /user:
    get:
      description: Возвращает информацию о текущем пользователе
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/user.ResponseUser'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Информацию о пользователе
      tags:
      - user
  /user/contacts:
    get:
      description: Возвращает список контактов текущего пользователя
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/user.ResponseContactsList'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Список контактов пользователя
      tags:
      - user/contacts
  /user/contacts/{id}/delete:
    post:
      description: Удаляет контакт текущего пользователя
      parameters:
      - description: Contact ID
        in: path
        name: id
        required: true
        type: string
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Удаление контакта пользователя
      tags:
      - user/contacts
  /user/contacts/{id}/verify:
    post:
      consumes:
      - application/json
      description: Верифицирует контакт текущего пользователя по одноразовому коду
      parameters:
      - description: Contact ID
        in: path
        name: id
        required: true
        type: string
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/user.RequestCode'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/user.ResponseSingleContact'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Верификация контакта пользователя
      tags:
      - user/contacts
  /user/contacts/add:
    post:
      consumes:
      - application/json
      description: Добавляет контакт текущему пользователю
      parameters:
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/user.RequestContact'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/user.ResponseSingleContact'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Добавление контакта пользователя
      tags:
      - user/contacts
  /user/sessions:
    get:
      description: Возвращает список сессий текущего пользователя
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/user.ResponseSessions'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Список сессий пользователя
      tags:
      - user/sessions
  /user/sessions/close:
    post:
      description: Закрывает все сессии пользователя кроме текущей
      produces:
      - application/json
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Заркытие сессий пользователя
      tags:
      - user/sessions
  /user/update:
    post:
      consumes:
      - application/json
      description: Обновляет параметры в профиле текущего пользователя
      parameters:
      - description: Request JSON
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/user.RequestParameter'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/user.ResponseUser'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/server.ResponseError'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/server.ResponseError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/server.ResponseError'
      security:
      - AccessJWT: []
      summary: Обновление профиль пользователе
      tags:
      - user
securityDefinitions:
  AccessJWT:
    in: header
    name: Authorization
    type: apiKey
  RefreshJWT:
    in: header
    name: Cookie
    type: apiKey
  StaticAccessToken:
    in: header
    name: X-Static-Access-Token
    type: apiKey
swagger: "2.0"
